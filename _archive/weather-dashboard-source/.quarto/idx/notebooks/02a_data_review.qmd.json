{"title":"WeatherVista Project - REVIEW Session 2: Data Review and Fetching","markdown":{"yaml":{"title":"WeatherVista Project - REVIEW Session 2: Data Review and Fetching","execute":{"enabled":false}},"headingText":"Objectives","containsRefs":false,"markdown":"\n\n- Learn how to fetch weather forecast data using the OpenWeatherMap API.\n- Understand how to process and save the fetched data.\n- Review the structure and content of the raw and processed data.\n- Calculate daily weather statistics from forecast data.\n\n#### 1. Introduction to Data Fetching\nIn this session, we will fetch weather forecast data from the OpenWeatherMap API and process it for analysis.\n\n##### Import Required Libraries\n```{python}\nimport requests\nimport pandas as pd\n```\n\n##### Set Up API Key and City\nReplace the placeholder with your own OpenWeatherMap API key.\n```{python}\n# Replace with your OpenWeatherMap API key\nAPI_KEY = 'YOUR_API_KEY'\ncity = 'London'\n```\n\n#### 2. Fetching Weather Forecast Data\nWe will define a function to fetch the 5-day weather forecast data for a specified city.\n\n##### Define Function to Fetch Data\n```{python}\n# Function to fetch data from the given URL and return JSON\ndef fetch_data(url):\n    response = requests.get(url)\n    data = response.json()\n    if response.status_code != 200:\n        print(f\"Error fetching data: {data}\")\n        return None\n    return data\n```\n\n##### Fetch Data\n```{python}\n# Fetch current weather data\ncurrent_url = f'http://api.openweathermap.org/data/2.5/weather?q={city}&appid={API_KEY}'\ncurrent_data = fetch_data(current_url)\n\n# Fetch 5-day forecast data\nforecast_url = f'http://api.openweathermap.org/data/2.5/forecast?q={city}&appid={API_KEY}'\nforecast_data = fetch_data(forecast_url)\n```\n\n#### 3. Processing and Saving Data\nWe will process the fetched data to extract relevant information and save it in CSV format.\n\n##### Parse Weather Data\n```{python}\n# Function to parse a single weather entry into a dictionary\ndef parse_weather(entry):\n    if entry is None:\n        return None\n    return {\n        'Datetime': pd.to_datetime(entry['dt'], unit='s'),\n        'Temperature (C)': entry['main']['temp'] - 273.15,\n        'Humidity (%)': entry['main']['humidity'],\n        'Wind Speed (m/s)': entry['wind']['speed'],\n        'Weather': entry['weather'][0]['description']\n    }\n```\n\n##### Extract and Process Data\n```{python}\n# Process current weather data\ncurrent_weather = parse_weather(current_data)\n\n# Process forecast weather data\nforecast_weather = [parse_weather(entry) for entry in forecast_data['list']]\n```\n\n##### Save Data to CSV\n```{python}\n# Function to save a list of dictionaries to a CSV file\ndef save_to_csv(data, filename):\n    if data is None or not data:\n        print(f\"No data to save for {filename}\")\n        return\n    df = pd.DataFrame(data)\n    df.to_csv(filename, index=False)\n    print(f\"{filename} saved\")\n\n# Save current weather data to CSV\nsave_to_csv([current_weather], '../data/processed/current_weather_data.csv')\n\n# Save forecast weather data to CSV\nsave_to_csv(forecast_weather, '../data/processed/hourly_weather_data.csv')\n```\n\n##### Calculate Daily Statistics\n```{python}\n# Function to calculate daily min and max stats from forecast data\ndef calculate_daily_stats(forecast_data):\n    if forecast_data is None or not forecast_data:\n        return None\n    \n    # Convert the list of dictionaries to a DataFrame\n    df_forecast = pd.DataFrame(forecast_data)\n    \n    # Extract the date from the 'Datetime' column and create a new 'Date' column\n    df_forecast['Date'] = df_forecast['Datetime'].dt.date\n\n    # Group the data by the 'Date' column and calculate the min and max for each group\n    daily_stats = df_forecast.groupby('Date').agg({\n        'Temperature (C)': ['min', 'max'],\n        'Humidity (%)': ['min', 'max'],\n        'Wind Speed (m/s)': ['min', 'max']\n    })\n\n    # Flatten the MultiIndex columns\n    daily_stats.columns = ['Min Temperature (C)', 'Max Temperature (C)', \n                           'Min Humidity (%)', 'Max Humidity (%)', \n                           'Min Wind Speed (m/s)', 'Max Wind Speed (m/s)']\n    \n    # Reset the index to turn the 'Date' back into a column\n    daily_stats.reset_index(inplace=True)\n    \n    return daily_stats\n\n# Calculate and save daily statistics to CSV\ndaily_stats = calculate_daily_stats(forecast_weather)\nsave_to_csv(daily_stats, '../data/processed/daily_weather_stats.csv')\n```\n\n#### 4. Reviewing the Data\nWe will review the structure and content of the raw and processed data to ensure it is correctly fetched and processed.\n\n##### Display the First Few Rows of Raw Data\n```{python}\ndf_raw = pd.read_csv('../data/processed/hourly_weather_data.csv')\ndf_raw.head()\n```\n\n##### Display the First Few Rows of Processed Data\n```{python}\ndf_processed = pd.read_csv('../data/processed/daily_weather_stats.csv')\ndf_processed.head()\n```\n\n#### Homework\n- Experiment with fetching data for different cities and review the structure of the fetched data.\n- Extend the data processing to include additional weather parameters if available.\n\n#### Summary\nIn this session, we learned how to fetch weather forecast data using the OpenWeatherMap API. We processed the data to convert temperature values from Kelvin to Celsius and saved both raw and processed data to CSV files. We also calculated daily weather statistics, preparing us for further analysis and visualization in upcoming sessions.","srcMarkdownNoYaml":"\n\n#### Objectives\n- Learn how to fetch weather forecast data using the OpenWeatherMap API.\n- Understand how to process and save the fetched data.\n- Review the structure and content of the raw and processed data.\n- Calculate daily weather statistics from forecast data.\n\n#### 1. Introduction to Data Fetching\nIn this session, we will fetch weather forecast data from the OpenWeatherMap API and process it for analysis.\n\n##### Import Required Libraries\n```{python}\nimport requests\nimport pandas as pd\n```\n\n##### Set Up API Key and City\nReplace the placeholder with your own OpenWeatherMap API key.\n```{python}\n# Replace with your OpenWeatherMap API key\nAPI_KEY = 'YOUR_API_KEY'\ncity = 'London'\n```\n\n#### 2. Fetching Weather Forecast Data\nWe will define a function to fetch the 5-day weather forecast data for a specified city.\n\n##### Define Function to Fetch Data\n```{python}\n# Function to fetch data from the given URL and return JSON\ndef fetch_data(url):\n    response = requests.get(url)\n    data = response.json()\n    if response.status_code != 200:\n        print(f\"Error fetching data: {data}\")\n        return None\n    return data\n```\n\n##### Fetch Data\n```{python}\n# Fetch current weather data\ncurrent_url = f'http://api.openweathermap.org/data/2.5/weather?q={city}&appid={API_KEY}'\ncurrent_data = fetch_data(current_url)\n\n# Fetch 5-day forecast data\nforecast_url = f'http://api.openweathermap.org/data/2.5/forecast?q={city}&appid={API_KEY}'\nforecast_data = fetch_data(forecast_url)\n```\n\n#### 3. Processing and Saving Data\nWe will process the fetched data to extract relevant information and save it in CSV format.\n\n##### Parse Weather Data\n```{python}\n# Function to parse a single weather entry into a dictionary\ndef parse_weather(entry):\n    if entry is None:\n        return None\n    return {\n        'Datetime': pd.to_datetime(entry['dt'], unit='s'),\n        'Temperature (C)': entry['main']['temp'] - 273.15,\n        'Humidity (%)': entry['main']['humidity'],\n        'Wind Speed (m/s)': entry['wind']['speed'],\n        'Weather': entry['weather'][0]['description']\n    }\n```\n\n##### Extract and Process Data\n```{python}\n# Process current weather data\ncurrent_weather = parse_weather(current_data)\n\n# Process forecast weather data\nforecast_weather = [parse_weather(entry) for entry in forecast_data['list']]\n```\n\n##### Save Data to CSV\n```{python}\n# Function to save a list of dictionaries to a CSV file\ndef save_to_csv(data, filename):\n    if data is None or not data:\n        print(f\"No data to save for {filename}\")\n        return\n    df = pd.DataFrame(data)\n    df.to_csv(filename, index=False)\n    print(f\"{filename} saved\")\n\n# Save current weather data to CSV\nsave_to_csv([current_weather], '../data/processed/current_weather_data.csv')\n\n# Save forecast weather data to CSV\nsave_to_csv(forecast_weather, '../data/processed/hourly_weather_data.csv')\n```\n\n##### Calculate Daily Statistics\n```{python}\n# Function to calculate daily min and max stats from forecast data\ndef calculate_daily_stats(forecast_data):\n    if forecast_data is None or not forecast_data:\n        return None\n    \n    # Convert the list of dictionaries to a DataFrame\n    df_forecast = pd.DataFrame(forecast_data)\n    \n    # Extract the date from the 'Datetime' column and create a new 'Date' column\n    df_forecast['Date'] = df_forecast['Datetime'].dt.date\n\n    # Group the data by the 'Date' column and calculate the min and max for each group\n    daily_stats = df_forecast.groupby('Date').agg({\n        'Temperature (C)': ['min', 'max'],\n        'Humidity (%)': ['min', 'max'],\n        'Wind Speed (m/s)': ['min', 'max']\n    })\n\n    # Flatten the MultiIndex columns\n    daily_stats.columns = ['Min Temperature (C)', 'Max Temperature (C)', \n                           'Min Humidity (%)', 'Max Humidity (%)', \n                           'Min Wind Speed (m/s)', 'Max Wind Speed (m/s)']\n    \n    # Reset the index to turn the 'Date' back into a column\n    daily_stats.reset_index(inplace=True)\n    \n    return daily_stats\n\n# Calculate and save daily statistics to CSV\ndaily_stats = calculate_daily_stats(forecast_weather)\nsave_to_csv(daily_stats, '../data/processed/daily_weather_stats.csv')\n```\n\n#### 4. Reviewing the Data\nWe will review the structure and content of the raw and processed data to ensure it is correctly fetched and processed.\n\n##### Display the First Few Rows of Raw Data\n```{python}\ndf_raw = pd.read_csv('../data/processed/hourly_weather_data.csv')\ndf_raw.head()\n```\n\n##### Display the First Few Rows of Processed Data\n```{python}\ndf_processed = pd.read_csv('../data/processed/daily_weather_stats.csv')\ndf_processed.head()\n```\n\n#### Homework\n- Experiment with fetching data for different cities and review the structure of the fetched data.\n- Extend the data processing to include additional weather parameters if available.\n\n#### Summary\nIn this session, we learned how to fetch weather forecast data using the OpenWeatherMap API. We processed the data to convert temperature values from Kelvin to Celsius and saved both raw and processed data to CSV files. We also calculated daily weather statistics, preparing us for further analysis and visualization in upcoming sessions."},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":false,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"jupyter"},"render":{"0":"*.qmd","1":"!*.ipynb","keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles.css"],"toc":true,"output-file":"02a_data_review.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.551","theme":"cosmo","title":"WeatherVista Project - REVIEW Session 2: Data Review and Fetching"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}