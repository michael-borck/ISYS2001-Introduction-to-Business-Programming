---
title: "Library Management System Workshop"
subtitle: "ISYS2001 Week 6 - In-Class Exercise 2"
format:
  html:
    toc: true
    toc-expand: 2
    embed-resources: true
  pdf:
    toc: false
    colorlinks: true
jupyter: python3
---

## üéØ Learning Objectives

By completing this workshop, you will:
- Build a complete library management system using dictionaries
- Implement CRUD operations (Create, Read, Update, Delete)
- Apply dictionary methods to solve real-world problems
- Practice error handling and user feedback
- Prepare for the mini-project by seeing dictionary applications in action

## üìö System Requirements

Your library management system needs to support:

1. **Add new books** to the catalog
2. **Check out books** (mark as unavailable)  
3. **Return books** (mark as available)
4. **Search for books** by title or author
5. **Generate reports** (available books, books by category)

## üèóÔ∏è Starting Infrastructure

Let's begin with our enhanced library catalog:

```{python}
# Enhanced library catalog with more books
library_catalog = {
    'book_001': {
        'title': 'Python Programming',
        'author': 'John Smith', 
        'isbn': '978-0123456789',
        'available': True,
        'category': 'Technology',
        'year': 2023
    },
    'book_002': {
        'title': 'Business Analytics',
        'author': 'Jane Doe',
        'isbn': '978-0987654321', 
        'available': False,
        'category': 'Business',
        'year': 2022
    },
    'book_003': {
        'title': 'Digital Marketing Strategy',
        'author': 'Mike Johnson',
        'isbn': '978-1234567890',
        'available': True,
        'category': 'Business',
        'year': 2024
    },
    'book_004': {
        'title': 'Web Development Fundamentals',
        'author': 'Sarah Wilson',
        'isbn': '978-2345678901',
        'available': True,
        'category': 'Technology',
        'year': 2023
    },
    'book_005': {
        'title': 'Financial Management',
        'author': 'David Brown',
        'isbn': '978-3456789012',
        'available': False,
        'category': 'Finance',
        'year': 2022
    }
}

print("Enhanced library catalog loaded!")
print(f"Total books: {len(library_catalog)}")
```

## Phase 1: Book Management Functions

### 1.1 Adding New Books

Let's create a robust function to add new books:

```{python}
def add_book(catalog, book_id, title, author, isbn, category, year=2024):
    """
    Add a new book to the catalog
    
    Args:
        catalog: The library catalog dictionary
        book_id: Unique identifier for the book
        title: Book title
        author: Book author
        isbn: Book ISBN
        category: Book category
        year: Publication year (default: 2024)
    """
    # Check if book_id already exists
    if book_id in catalog:
        print(f"Error: Book ID '{book_id}' already exists!")
        return False
    
    # Add the new book
    catalog[book_id] = {
        'title': title,
        'author': author,
        'isbn': isbn,
        'available': True,  # New books are available
        'category': category,
        'year': year
    }
    
    print(f"‚úÖ Successfully added: '{title}' by {author}")
    return True

# Test the function
add_book(library_catalog, 'book_006', 'Data Science with Python', 
         'Alice Cooper', '978-4567890123', 'Technology', 2024)

# Try to add a duplicate (should fail)
add_book(library_catalog, 'book_006', 'Another Book', 'Another Author', 
         '978-9999999999', 'Test')
```

### 1.2 Your Turn: Implement Book Removal

Complete this function to remove books from the catalog:

```{python}
def remove_book(catalog, book_id):
    """
    Remove a book from the catalog
    
    Args:
        catalog: The library catalog dictionary
        book_id: ID of book to remove
    """
    # TODO: Check if book exists using .get()
    # TODO: If exists, remove it and print success message
    # TODO: If not exists, print error message
    # TODO: Return True if successful, False if failed
    
    pass

# Test your function
print("Testing book removal:")
remove_book(library_catalog, 'book_006')  # Should succeed
remove_book(library_catalog, 'book_999')  # Should fail gracefully
```

**Solution (run after trying above):**

```{python}
def remove_book(catalog, book_id):
    """Remove a book from the catalog"""
    book = catalog.get(book_id)
    if book:
        title = book['title']
        del catalog[book_id]
        print(f"‚úÖ Successfully removed: '{title}'")
        return True
    else:
        print(f"‚ùå Error: Book ID '{book_id}' not found!")
        return False

# Test the corrected function
print("Testing corrected book removal:")
add_book(library_catalog, 'book_006', 'Test Book', 'Test Author', '123', 'Test')
remove_book(library_catalog, 'book_006')
```

## Phase 2: Checkout and Return System

### 2.1 Checkout System

```{python}
def checkout_book(catalog, book_id, borrower_name):
    """
    Check out a book to a borrower
    
    Args:
        catalog: The library catalog dictionary
        book_id: ID of book to checkout
        borrower_name: Name of person checking out the book
    """
    book = catalog.get(book_id)
    
    if not book:
        print(f"‚ùå Book ID '{book_id}' not found!")
        return False
    
    if not book['available']:
        print(f"‚ùå '{book['title']}' is already checked out!")
        return False
    
    # Update book status
    book['available'] = False
    book['borrower'] = borrower_name
    
    print(f"‚úÖ '{book['title']}' checked out to {borrower_name}")
    return True

# Test checkout
checkout_book(library_catalog, 'book_001', 'Alice Student')
checkout_book(library_catalog, 'book_001', 'Bob Student')  # Should fail
```

### 2.2 Your Turn: Implement Return System

Complete the return function:

```{python}
def return_book(catalog, book_id):
    """
    Return a checked-out book
    
    Args:
        catalog: The library catalog dictionary
        book_id: ID of book to return
    """
    # TODO: Check if book exists
    # TODO: Check if book is actually checked out
    # TODO: Mark as available and remove borrower info
    # TODO: Print appropriate messages
    # TODO: Return success/failure status
    
    pass

# Test your function
return_book(library_catalog, 'book_001')  # Should succeed
return_book(library_catalog, 'book_003')  # Should handle "not checked out" case
```

**Solution:**

```{python}
def return_book(catalog, book_id):
    """Return a checked-out book"""
    book = catalog.get(book_id)
    
    if not book:
        print(f"‚ùå Book ID '{book_id}' not found!")
        return False
    
    if book['available']:
        print(f"‚ùå '{book['title']}' was not checked out!")
        return False
    
    # Return the book
    borrower = book.get('borrower', 'Unknown')
    book['available'] = True
    if 'borrower' in book:
        del book['borrower']
    
    print(f"‚úÖ '{book['title']}' returned by {borrower}")
    return True

# Test the solution
return_book(library_catalog, 'book_001')
return_book(library_catalog, 'book_003')
```

## Phase 3: Search and Analysis Functions

### 3.1 Advanced Search Function

```{python}
def search_books(catalog, search_term, search_fields=['title', 'author']):
    """
    Search for books by multiple criteria
    
    Args:
        catalog: The library catalog dictionary
        search_term: Term to search for
        search_fields: Fields to search in (default: title and author)
    
    Returns:
        List of matching book information
    """
    matches = []
    search_lower = search_term.lower()
    
    for book_id, book_info in catalog.items():
        # Check each specified field
        for field in search_fields:
            if field in book_info and search_lower in str(book_info[field]).lower():
                match_info = {
                    'id': book_id,
                    'title': book_info['title'],
                    'author': book_info['author'],
                    'category': book_info['category'],
                    'available': book_info['available']
                }
                matches.append(match_info)
                break  # Don't add the same book multiple times
    
    return matches

# Test the search function
print("=== Search Results ===")
results = search_books(library_catalog, 'python')
for book in results:
    status = "‚úÖ Available" if book['available'] else "‚ùå Checked out"
    print(f"- {book['title']} by {book['author']} ({status})")

print("\nSearch by category:")
results = search_books(library_catalog, 'technology', ['category'])
for book in results:
    status = "‚úÖ Available" if book['available'] else "‚ùå Checked out"
    print(f"- {book['title']} ({status})")
```

### 3.2 Your Turn: Books by Category Function

Create a function that groups books by category:

```{python}
def books_by_category(catalog):
    """
    Group books by category
    
    Returns:
        Dictionary with categories as keys and book lists as values
    """
    # TODO: Create empty dictionary to store results
    # TODO: Loop through catalog and group by category
    # TODO: Return the grouped results
    
    pass

# Test your function
categories = books_by_category(library_catalog)
for category, books in categories.items():
    print(f"\n{category} ({len(books)} books):")
    for book in books:
        print(f"  - {book}")
```

**Solution:**

```{python}
def books_by_category(catalog):
    """Group books by category"""
    categories = {}
    
    for book_info in catalog.values():
        category = book_info['category']
        if category not in categories:
            categories[category] = []
        categories[category].append(book_info['title'])
    
    return categories

# Test the solution
print("=== Books by Category ===")
categories = books_by_category(library_catalog)
for category, books in categories.items():
    print(f"\n{category} ({len(books)} books):")
    for book in books:
        print(f"  - {book}")
```

## Phase 4: Comprehensive Reports

### 4.1 Availability Report

```{python}
def generate_availability_report(catalog):
    """Generate detailed availability report"""
    available_books = []
    checked_out_books = []
    
    for book_id, book_info in catalog.items():
        book_summary = {
            'id': book_id,
            'title': book_info['title'],
            'author': book_info['author'],
            'category': book_info['category']
        }
        
        if book_info['available']:
            available_books.append(book_summary)
        else:
            book_summary['borrower'] = book_info.get('borrower', 'Unknown')
            checked_out_books.append(book_summary)
    
    print("=" * 50)
    print("LIBRARY AVAILABILITY REPORT")
    print("=" * 50)
    
    print(f"\nüìö AVAILABLE BOOKS ({len(available_books)}):")
    for book in available_books:
        print(f"  ‚úÖ [{book['id']}] {book['title']} - {book['author']} ({book['category']})")
    
    print(f"\nüîí CHECKED OUT BOOKS ({len(checked_out_books)}):")
    for book in checked_out_books:
        borrower = book.get('borrower', 'Unknown')
        print(f"  ‚ùå [{book['id']}] {book['title']} - {book['author']} ‚Üí {borrower}")
    
    print(f"\nüìä SUMMARY:")
    total = len(catalog)
    print(f"  Total books: {total}")
    print(f"  Available: {len(available_books)} ({len(available_books)/total*100:.1f}%)")
    print(f"  Checked out: {len(checked_out_books)} ({len(checked_out_books)/total*100:.1f}%)")

# Generate the report
generate_availability_report(library_catalog)
```

### 4.2 Category Statistics

```{python}
def category_statistics(catalog):
    """Generate statistics by category"""
    stats = {}
    
    for book_info in catalog.values():
        category = book_info['category']
        if category not in stats:
            stats[category] = {
                'total': 0,
                'available': 0,
                'checked_out': 0,
                'newest_year': 0
            }
        
        stats[category]['total'] += 1
        if book_info['available']:
            stats[category]['available'] += 1
        else:
            stats[category]['checked_out'] += 1
        
        # Track newest publication year
        year = book_info.get('year', 0)
        if year > stats[category]['newest_year']:
            stats[category]['newest_year'] = year
    
    print("=" * 50)
    print("CATEGORY STATISTICS REPORT")
    print("=" * 50)
    
    for category, data in stats.items():
        availability_rate = (data['available'] / data['total']) * 100
        print(f"\nüìñ {category.upper()}")
        print(f"  Total books: {data['total']}")
        print(f"  Available: {data['available']} ({availability_rate:.1f}%)")
        print(f"  Checked out: {data['checked_out']}")
        print(f"  Newest publication: {data['newest_year']}")

# Generate category statistics
category_statistics(library_catalog)
```

## Phase 5: Interactive System Demo

### 5.1 Simple Menu System

```{python}
def display_menu():
    """Display the main menu options"""
    print("\n" + "=" * 40)
    print("LIBRARY MANAGEMENT SYSTEM")
    print("=" * 40)
    print("1. Add new book")
    print("2. Search books")
    print("3. Check out book")
    print("4. Return book") 
    print("5. Availability report")
    print("6. Category statistics")
    print("7. Exit")
    print("-" * 40)

# Demo the menu (in a real system, this would be in a loop)
display_menu()
```

### 5.2 Your Turn: Complete Integration Test

Test all your functions together:

```{python}
print("=== INTEGRATION TEST ===")

# Test 1: Add a new book
print("\n1. Adding new book...")
add_book(library_catalog, 'book_007', 'Machine Learning Basics', 
         'Dr. Smith', '978-7890123456', 'Technology', 2024)

# Test 2: Search for the new book
print("\n2. Searching for machine learning books...")
results = search_books(library_catalog, 'machine learning')
for book in results:
    print(f"Found: {book['title']} by {book['author']}")

# Test 3: Check out the book
print("\n3. Checking out book...")
checkout_book(library_catalog, 'book_007', 'Test Student')

# Test 4: Generate availability report
print("\n4. Current availability:")
generate_availability_report(library_catalog)

# Test 5: Return the book
print("\n5. Returning book...")
return_book(library_catalog, 'book_007')

print("\n‚úÖ Integration test completed successfully!")
```

## üéØ Workshop Summary

### What You've Accomplished

Through this workshop, you've built a complete library management system with:

‚úÖ **CRUD Operations**: Create, Read, Update, Delete books  
‚úÖ **Safe Dictionary Access**: Using `.get()` to prevent errors  
‚úÖ **Dictionary Methods**: Applied `.keys()`, `.values()`, `.items()`  
‚úÖ **Error Handling**: Graceful handling of missing books and invalid operations  
‚úÖ **Data Analysis**: Generated reports and statistics  
‚úÖ **Real-World Application**: Practical system that could actually be used  

### Key Dictionary Concepts Reinforced

1. **Nested Dictionary Structures**: Organized complex data hierarchically
2. **Dictionary Methods**: Used appropriate methods for different tasks
3. **Dynamic Updates**: Modified dictionary contents during runtime
4. **Safe Access Patterns**: Prevented KeyError exceptions
5. **Data Aggregation**: Grouped and analyzed dictionary data

## üöÄ Preparing for Your Mini-Project

The skills you've practiced here directly apply to your mini-project:

| Library System | Finance Tracker |
|----------------|-----------------|
| Book catalog | Expense records |
| Book checkout/return | Add/edit expenses |
| Search books | Find expenses by category |
| Category reports | Budget analysis |
| Availability status | Spending summaries |

### Mini-Project Success Tips

1. **Start with Data Structure**: Plan your dictionary structure before coding
2. **Use Safe Access**: Always use `.get()` when keys might not exist
3. **Group Related Data**: Put related information together in nested dictionaries
4. **Apply Dictionary Methods**: Use `.items()`, `.values()`, `.keys()` appropriately
5. **Handle Edge Cases**: What happens if data is missing or invalid?

## üìù Reflection Questions

1. How did using dictionaries make the library system more organized than lists would have?
2. Which dictionary methods were most useful for analysis and reporting?
3. How will you apply these patterns to your finance tracker project?
4. What additional features could you add using dictionary concepts?

## üéì Next Steps

You're now ready to tackle your mini-project! You can choose between:

- **Pathway A**: Transform your Week 5 list-based finance tracker to use dictionaries
- **Pathway B**: Build a fresh dictionary-based finance tracker from scratch

Either way, you have the dictionary skills needed to create an impressive financial management system.

**Good luck with your mini-project!** üéâ